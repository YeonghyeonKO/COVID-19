for (j in seq(from = 3, by = 2, length.out = 6)){
assign(paste0("cases_smoothing_", j), pracma::movavg(df$cases, j, type = "s"))
df <- cbind(df, get(paste0("cases_smoothing_", j)))
colnames(df[, ncol(df)]) = paste0("cases_smoothing_", j)
}
df <- read.csv(paste0(data_path, "corona_ecdc.csv")) %>%
mutate(date = make_datetime(year, month, day),
country = countriesAndTerritories) %>%
filter(date < "2020-07-11",) %>%
select(country, date, cases, deaths) %>%
arrange(country, date)
for (i in which(df$cases < 0)){df$cases[i] = 0} # Case < 0 처리 (0으로 대체)
for (j in seq(from = 3, by = 2, length.out = 6)){
assign(paste0("cases_smoothing_", j), pracma::movavg(df$cases, j, type = "s"))
df <- cbind(df, get(paste0("cases_smoothing_", j)))
colnames(df)[ncol(df)] = paste0("cases_smoothing_", j)
}
View(df)
country2 <- c("China", "Japan", "Nepal", "Puerto_Rico", "Tunisia", "New_Zealand", "Burkina_Faso")
num <- df %>%
group_by(country) %>%
mutate(total = cumsum(cases)) %>%
filter(total > 0, country %in% country2) %>%
summarise(count = n())
View(num)
num <- df %>%
group_by(country) %>%
mutate(total = cumsum(cases)) %>%
filter(total > 0, country !%in% country2) %>%
summarise(count = n())
country2 <- c("China", "Japan", "Nepal", "Puerto_Rico", "Tunisia", "New_Zealand", "Burkina_Faso")
num <- df %>%
group_by(country) %>%
mutate(total = cumsum(cases)) %>%
filter(total > 0, country %notin% country2) %>%
summarise(count = n())
`%notin%` <- purrr::negate(`%in%`)
num <- df %>%
group_by(country) %>%
mutate(total = cumsum(cases)) %>%
filter(total > 0, country %notin% country2) %>%
summarise(count = n())
View(num)
n <- 0; coef_Poi <- data.frame()
n <- 0; coef_Poi <- data.frame(); coef_Poi_smoothing <- data.frmae()
n <- 0; coef_Poi <- data.frame(); coef_Poi_smoothing <- data.frame()
for (k in num$country){
print(k)
}
for (k in num$country){
n <- n + 1
data_0710 <- df %>%
filter(country == i) %>%
mutate(total = cumsum(cases)) %>%
filter(total >= 1) %>%
mutate(Days_after_first_Case = 1:num$count[n]) %>%
filter(date < "2020-07-11")
}
data_0710 <- df %>%
filter(country == i) %>%
mutate(total = cumsum(cases)) %>%
filter(total >= 1)
View(data_0710)
data_0710 <- df %>%
filter(country == i)
data_0710 <- df
for (k in num$country){
n <- n + 1
data_0710 <- df %>%
filter(country == k) %>%
mutate(total = cumsum(cases)) %>%
filter(total >= 1) %>%
mutate(Days_after_first_Case = 1:num$count[n]) %>%
filter(date < "2020-07-11")
}
View(data_0710)
df %>%
filter(country == k)
df %>%
filter(country == k) %>%
mutate(total = cumsum(cases))
View(data_0710)
df %>%
filter(country == k) %>%
mutate(total = cumsum(cases)) %>%
filter(total >= 1)
df %>%
filter(country == k) %>%
mutate(total = cumsum(cases)) %>%
filter(total >= 1) %>%
mutate(Days_after_first_Case = 1:num$count[n])
1:num$count[n]
data_0710 <- df %>%
filter(country == k) %>%
mutate(total = cumsum(cases)) %>%
filter(total >= 1)
View(data_0710)
View(num)
n <- 0; coef_Poi <- data.frame(); coef_Poi_smoothing <- data.frame()
for (k in num$country){
n <- n + 1
data_0710 <- df %>%
filter(country == k) %>%
mutate(total = cumsum(cases)) %>%
filter(total >= 1) %>%
mutate(Days_after_first_Case = 1:num$count[n]) %>%
filter(date < "2020-07-11")
}
View(data_0710)
ncol(total)
data_0710 <- df %>%
filter(country == k) %>%
mutate(total = cumsum(cases)) %>%
filter(total >= 1) %>%
mutate(Days_after_first_Case = 1:num$count[n]) %>%
filter(date < "2020-07-11") %>%
group_by(country) %>%
filter(total[ncol(total)] >= 300)
for (k in num$country){
n <- n + 1
data_0710 <- df %>%
filter(country == k) %>%
mutate(total = cumsum(cases)) %>%
filter(total >= 1) %>%
mutate(Days_after_first_Case = 1:num$count[n]) %>%
filter(date < "2020-07-11") %>%
group_by(country) %>%
filter(total[ncol(total)] >= 300)
}
n <- 0; coef_Poi <- data.frame(); coef_Poi_smoothing <- data.frame()
for (k in num$country){
n <- n + 1
data_0710 <- df %>%
filter(country == k) %>%
mutate(total = cumsum(cases)) %>%
filter(total >= 1) %>%
mutate(Days_after_first_Case = 1:num$count[n]) %>%
filter(date < "2020-07-11") %>%
group_by(country) %>%
filter(total[ncol(total)] >= 300)
}
data_0710 <- df %>%
filter(country == k) %>%
mutate(total = cumsum(cases)) %>%
filter(total >= 1) %>%
mutate(Days_after_first_Case = 1:num$count[n]) %>%
filter(date < "2020-07-11")
data_0710 <- df %>%
filter(country == k) %>%
mutate(total = cumsum(cases)) %>%
filter(total >= 1) %>%
mutate(Days_after_first_Case = 1:num$count[n]) %>%
filter(date < "2020-07-11") %>%
group_by(country)
data_0710 <- df %>%
filter(country == k) %>%
mutate(total = cumsum(cases)) %>%
filter(total >= 1) %>%
mutate(Days_after_first_Case = 1:num$count[n]) %>%
filter(date < "2020-07-11") %>%
group_by(country) %>%
filter(total[ncol(total)] >= 300)
ncol(df$total)
df$total
data_0710$total
ncol(data_0710$total)
View(data_0710)
View(data_0710)
df$total
data_0710 <- df %>%
filter(country == k) %>%
mutate(total = cumsum(cases)) %>%
filter(total >= 1) %>%
mutate(Days_after_first_Case = 1:num$count[n]) %>%
filter(date < "2020-07-11") %>%
group_by(country) %>%
filter(country = df$total[count[n]] >= 300)
df$total
df$count[n]
View(df)
View(df)
View(df)
data_0710 <- df %>%
filter(country == k) %>%
mutate(total = cumsum(cases)) %>%
filter(total >= 1) %>%
mutate(Days_after_first_Case = 1:num$count[n]) %>%
filter(date < "2020-07-11")
View(data_0710)
data_0710 <- df %>%
filter(country == k) %>%
mutate(total = cumsum(cases)) %>%
filter(total >= 1) %>%
mutate(Days_after_first_Case = 1:num$count[n]) %>%
filter(date < "2020-07-11")
View(data_0710)
days <- num$count[n]
days
data_0710 <- df %>%
filter(country == k) %>%
mutate(total = cumsum(cases)) %>%
filter(total >= 1) %>%
mutate(Days_after_first_Case = 1:days) %>%
filter(date < "2020-07-11")
View(data_0710)
data_0710$total[days]
for (k in num$country){
n <- n + 1
days <- num$count[n]
data_0710 <- df %>%
filter(country == k) %>%
mutate(total = cumsum(cases)) %>%
filter(total >= 1) %>%
mutate(Days_after_first_Case = 1:days) %>%
filter(date < "2020-07-11")
if (data_0710$total[days] < 300){
pass
}
print(n)
}
n <- 0; coef_Poi <- data.frame(); coef_Poi_smoothing <- data.frame()
for (k in num$country){
n <- n + 1
days <- num$count[n]
data_0710 <- df %>%
filter(country == k) %>%
mutate(total = cumsum(cases)) %>%
filter(total >= 1) %>%
mutate(Days_after_first_Case = 1:days) %>%
filter(date < "2020-07-11")
if (data_0710$total[days] < 300){
pass
}
print(n)
}
data_0710 <- df %>%
filter(country == k) %>%
mutate(total = cumsum(cases)) %>%
filter(total >= 1) %>%
mutate(Days_after_first_Case = 1:days) %>%
filter(date < "2020-07-11") %>%
group_by(country) %>%
filter(totla[days] >= 300)
data_0710 <- df %>%
filter(country == k) %>%
mutate(total = cumsum(cases)) %>%
filter(total >= 1) %>%
mutate(Days_after_first_Case = 1:days) %>%
filter(date < "2020-07-11") %>%
group_by(country) %>%
filter(total[days] >= 300)
View(data_0710)
for (k in num$country){
n <- n + 1
days <- num$count[n]
data_0710 <- df %>%
filter(country == k) %>%
mutate(total = cumsum(cases)) %>%
filter(total >= 1) %>%
mutate(Days_after_first_Case = 1:days) %>%
filter(date < "2020-07-11") %>%
group_by(country) %>%
filter(total[days] >= 300)
if (data_0710$total[days] < 300){
pass
}
print(n)
}
num <- df %>%
group_by(country) %>%
mutate(total = cumsum(cases)) %>%
filter(total > 300, country %notin% country2) %>%
summarise(count = n()) %>%
df$
n <- 0; coef_Poi <- data.frame(); coef_Poi_smoothing <- data.frame()
num <- df %>%
group_by(country) %>%
mutate(total = cumsum(cases)) %>%
filter(total > 300, country %notin% country2) %>%
summarise(count = n())
View(num)
num <- df %>%
group_by(country) %>%
mutate(total = cumsum(cases)) %>%
filter(country %notin% country2) %>%
summarise(count = n())
View(num)
num <- df %>%
group_by(country) %>%
mutate(total = cumsum(cases)) %>%
filter(total > 0, country %notin% country2) %>%
summarise(count = n())
View(num)
View(data_0710)
View(df)
num <- df %>%
group_by(country) %>%
mutate(total = cumsum(cases)) %>%
filter(total > 0, country %notin% country2) %>%
summarise(count = n())
for (k in num$country){
n <- n + 1
days <- num$count[n]
data_0710 <- df %>%
filter(country == k) %>%
mutate(total = cumsum(cases)) %>%
filter(total >= 1) %>%
mutate(Days_after_first_Case = 1:days) %>%
filter(date < "2020-07-11")
if (data_0710$total[days] < 300){
next
}
print(n)
}
n <- 0; coef_Poi <- data.frame(); coef_Poi_smoothing <- data.frame()
for (k in num$country){
n <- n + 1
days <- num$count[n]
data_0710 <- df %>%
filter(country == k) %>%
mutate(total = cumsum(cases)) %>%
filter(total >= 1) %>%
mutate(Days_after_first_Case = 1:days) %>%
filter(date < "2020-07-11")
if (data_0710$total[days] < 300){
next
}
print(n)
}
View(num)
fit <- glm(cases ~ log(Days_after_first_Case) + Days_after_first_Case, data = data_0710, family = poisson)
View(data_0710)
fit_s <- segmented(fit, seg.Z = ~ log(Days_after_first_Case) + Days_after_first_Case, npsi = 1)
fit_s
fit
View(data_0710)
fit_s <- glm(cases_smoothing_7 ~ log(Days_after_first_Case) + Days_after_first_Case, data = data_0710, family = poisson)
warnings()
fit_s
nrow(num)
n <- 0; coef_Poi <- data.frame(matrix(NA, nrow = 3, ncol = nrow(num))); coef_Poi_smoothing <- data.frame()
View(coef_Poi)
View(coef_Poi)
colnames(coef_Poi) <- num$country
View(coef_Poi)
colnames(coef_Poi) <- num$country; rownames(coef_Poi) <- c("Poisson", "Smoothing_Poisson")
n <- 0; coef_Poi <- data.frame(matrix(NA, nrow = 2, ncol = nrow(num))); coef_Poi_smoothing <- data.frame()
colnames(coef_Poi) <- num$country; rownames(coef_Poi) <- c("Poisson", "Smoothing_Poisson")
View(coef_Poi)
n <- 0; coef_Poi <- data.frame(matrix(NA, nrow = 7, ncol = nrow(num))); coef_Poi_smoothing <- data.frame()
for (j in seq(from = 3, by = 2, length.out = 6)){
for (k in num$country){
n <- n + 1
days <- num$count[n]
data_0710 <- df %>%
filter(country == k) %>%
mutate(total = cumsum(cases)) %>%
filter(total >= 1) %>%
mutate(Days_after_first_Case = 1:days) %>%
filter(date < "2020-07-11")
if (data_0710$total[days] < 300){
next
}
fit <- glm(cases ~ log(Days_after_first_Case) + Days_after_first_Case, data = data_0710, family = poisson)
fit_s <- glm(cases_smoothing_7 ~ log(Days_after_first_Case) + Days_after_first_Case, data = data_0710, family = poisson)
# coef_Poi[]
}
}
paste0("cases_smoothing_", j)
fit_s <- glm(paste0("cases_smoothing_", j) ~ log(Days_after_first_Case) + Days_after_first_Case, data = data_0710, family = poisson)
fit_s <- glm(paste0("cases_smoothing_", j) ~ log(Days_after_first_Case) + Days_after_first_Case, data = data_0710, family = poisson)
fit <- glm(cases ~ log(Days_after_first_Case) + Days_after_first_Case, data = data_0710, family = poisson)
fit_s <- glm(cases_smoothing_7 ~ log(Days_after_first_Case) + Days_after_first_Case, data = data_0710, family = poisson)
fit
coef_Poi[n, k]
fit$coefficients
coef_Poi[, k] <- fit$coefficients
fit$coefficients
coef_Poi[, k] <- fit$coefficients[3]
fit$coefficients[3]
coef_Poi[, k] <- type(fit$coefficients[3])
type(fit$coefficients[3])
str(fit$coefficients)
coef_Poi[, k]
n <- 0; coef_Poi <- data.frame(matrix(NA, nrow = 2, ncol = nrow(num))); coef_Poi_smoothing <- data.frame()
coef_Poi[, k] <- fit$coefficients
n <- 0; coef_Poi <- data.frame(matrix(NA, nrow = 6, ncol = nrow(num))); coef_Poi_smoothing <- data.frame()
coef_Poi[, k] <- fit$coefficients
View(coef_Poi)
colnames(coef_Poi) <- num$country
coef_Poi[, k] <- fit$coefficients
View(coef_Poi)
coef_Poi[, k] <- c(fit$coefficients, fit_s$coefficients)
View(coef_Poi)
fit$coefficients
cases
View(data_0710)
df <- read.csv(paste0(data_path, "corona_ecdc.csv")) %>%
mutate(date = make_datetime(year, month, day),
country = countriesAndTerritories) %>%
filter(date < "2020-07-11",) %>%
select(country, date, cases, deaths) %>%
arrange(country, date)
for (i in which(df$cases < 0)){df$cases[i] = 0} # Case < 0 처리 (0으로 대체)
for (j in seq(from = 3, by = 2, length.out = 6)){
assign(paste0("cases_smoothing_", j), pracma::movavg(df$cases, j, type = "s"))
df <- cbind(df, get(paste0("cases_smoothing_", j)))
colnames(df)[ncol(df)] = paste0("cases_smoothing_", j)
}
View(df)
# 잘 적합되지 않는 국가들 list
country2 <- c("China", "Japan", "Nepal", "Puerto_Rico", "Tunisia", "New_Zealand", "Burkina_Faso")
`%notin%` <- purrr::negate(`%in%`)
num <- df %>%
group_by(country) %>%
mutate(total = cumsum(cases)) %>%
filter(total > 0, country %notin% country2) %>%
summarise(count = n())
n <- 0; coef_Poi <- data.frame(matrix(NA, nrow = 6, ncol = nrow(num))); coef_Poi_smoothing <- data.frame()
colnames(coef_Poi) <- num$country
for (k in num$country){
n <- n + 1
days <- num$count[n]
data_0710 <- df %>%
filter(country == k) %>%
mutate(total = cumsum(cases)) %>%
filter(total >= 1) %>%
mutate(Days_after_first_Case = 1:days) %>%
filter(date < "2020-07-11")
if (data_0710$total[days] < 300){
next
}
fit <- glm(cases ~ log(Days_after_first_Case) + Days_after_first_Case, data = data_0710, family = poisson)
fit_s <- glm(cases_smoothing_7 ~ log(Days_after_first_Case) + Days_after_first_Case, data = data_0710, family = poisson)
coef_Poi[, k] <- c(fit$coefficients, fit_s$coefficients)
}
View(coef_Poi)
levels(fit$coefficients)
names(fit$coefficients)
names(fit$coefficients)+"_s"
names(fit$coefficients) + "_s"
names(fit$coefficients)
paste0(names(fit$coefficients), "_s")
colnames(coef_Poi) <- num$country
rownames(coef_POi) <- c(names(fit$coefficients), paste0(names(fit$coefficients), "_s"))
rownames(coef_pOi) <- c(names(fit$coefficients), paste0(names(fit$coefficients), "_s"))
rownames(coef_poi) <- c(names(fit$coefficients), paste0(names(fit$coefficients), "_s"))
colnames(coef_Poi) <- num$country
rownames(coef_poi) <- c(names(fit$coefficients), paste0(names(fit$coefficients), "_s"))
rownames(coef_Poi) <- c(names(fit$coefficients), paste0(names(fit$coefficients), "_s"))
View(coef_Poi)
View(coef_Poi)
n <- 0; coef_Poi <- data.frame(matrix(NA, ncol = 6, nrow = nrow(num))); coef_Poi_smoothing <- data.frame()
n <- 0; coef_Poi <- data.frame(matrix(NA, ncol = 6, nrow = nrow(num))); coef_Poi_smoothing <- data.frame()
for (k in num$country){
n <- n + 1
days <- num$count[n]
data_0710 <- df %>%
filter(country == k) %>%
mutate(total = cumsum(cases)) %>%
filter(total >= 1) %>%
mutate(Days_after_first_Case = 1:days) %>%
filter(date < "2020-07-11")
if (data_0710$total[days] < 300){
next
}
fit <- glm(cases ~ log(Days_after_first_Case) + Days_after_first_Case, data = data_0710, family = poisson)
fit_s <- glm(cases_smoothing_7 ~ log(Days_after_first_Case) + Days_after_first_Case, data = data_0710, family = poisson)
coef_Poi[k, ] <- c(fit$coefficients, fit_s$coefficients)
}
View(coef_Poi)
n <- 0; coef_Poi <- data.frame(matrix(NA, ncol = 6, nrow = nrow(num))); coef_Poi_smoothing <- data.frame()
colnames(coef_Poi) <- num$country
rownames(coef_Poi) <- c(names(fit$coefficients), paste0(names(fit$coefficients), "_s"))
colnames(coef_Poi) <- c(names(fit$coefficients), paste0(names(fit$coefficients), "_s"))
rownames(coef_Poi) <- num$country
for (k in num$country){
n <- n + 1
days <- num$count[n]
data_0710 <- df %>%
filter(country == k) %>%
mutate(total = cumsum(cases)) %>%
filter(total >= 1) %>%
mutate(Days_after_first_Case = 1:days) %>%
filter(date < "2020-07-11")
if (data_0710$total[days] < 300){
next
}
fit <- glm(cases ~ log(Days_after_first_Case) + Days_after_first_Case, data = data_0710, family = poisson)
fit_s <- glm(cases_smoothing_7 ~ log(Days_after_first_Case) + Days_after_first_Case, data = data_0710, family = poisson)
coef_Poi[k, ] <- c(fit$coefficients, fit_s$coefficients)
}
View(coef_Poi)
colnames(coef_Poi) <- c(names(fit$coefficients), paste0(names(fit$coefficients), "_smoothing"))
rownames(coef_Poi) <- num$country
for (k in num$country){
n <- n + 1
days <- num$count[n]
data_0710 <- df %>%
filter(country == k) %>%
mutate(total = cumsum(cases)) %>%
filter(total >= 1) %>%
mutate(Days_after_first_Case = 1:days) %>%
filter(date < "2020-07-11")
if (data_0710$total[days] < 300){
next
}
fit <- glm(cases ~ log(Days_after_first_Case) + Days_after_first_Case, data = data_0710, family = poisson)
fit_s <- glm(cases_smoothing_7 ~ log(Days_after_first_Case) + Days_after_first_Case, data = data_0710, family = poisson)
coef_Poi[k, ] <- c(fit$coefficients, fit_s$coefficients)
}
write.csv(coef_Poi, paste0(result_path, "Coef_Poi.csv"), row.names = T)
